<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Models · IOV Documentations</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&gt; code reference (model): https://github.com/iov-one/blog-tutorial/blob/master/x/blog/model.go"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Models · IOV Documentations"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.iov.one/"/><meta property="og:description" content="&gt; code reference (model): https://github.com/iov-one/blog-tutorial/blob/master/x/blog/model.go"/><meta property="og:image" content="https://docs.iov.one/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://docs.iov.one/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="IOV Documentations"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://github.com/iov-one" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Tutorial</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Introduction<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/intro">Welcome to IOV!</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">IOV Name Service<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Validator</h4><ul><li class="navListItem"><a class="navItem" href="/docs/iov-name-service/validator/rewards">Rewards</a></li><li class="navListItem"><a class="navItem" href="/docs/iov-name-service/validator/testnet-dancenet">Testnet (deprecated)</a></li><li class="navListItem"><a class="navItem" href="/docs/iov-name-service/validator/testnet">Testnet v1.0.0</a></li><li class="navListItem"><a class="navItem" href="/docs/iov-name-service/validator/mainnet">Mainnet</a></li><li class="navListItem"><a class="navItem" href="/docs/iov-name-service/validator/troubleshooter">Troubleshooter</a></li><li class="navListItem"><a class="navItem" href="/docs/iov-name-service/validator/faq">FAQ</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Clients</h4><ul><li class="navListItem"><a class="navItem" href="/docs/iov-name-service/clients/iov-core">IOV Core</a></li><li class="navListItem"><a class="navItem" href="/docs/iov-name-service/clients/rest-api">REST API</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">IOV Weave SDK<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/weave/welcome">Welcome</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Basics</h4><ul><li class="navListItem"><a class="navItem" href="/docs/weave/basics/blockchain">Blockchain</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/basics/consensus">Consensus</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/basics/authentication">Authentication</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/basics/state">State Machine</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Design</h4><ul><li class="navListItem"><a class="navItem" href="/docs/weave/design/overview">Guiding Design Principles</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/design/extension">Extension</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/design/transaction-flow">Flow of Transactions</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/design/permissions">Permissions</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/design/queries">Queries</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/design/prototool">Prototool</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Configuration</h4><ul><li class="navListItem"><a class="navItem" href="/docs/weave/configuration/application">Application</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API specifications</h4><ul><li class="navListItem"><a class="navItem" href="/docs/weave/weave-api-spec/address-derivation">Address Derivation</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/weave-api-spec/weave-transaction-spec">Weave Transactions</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/weave-api-spec/tx-sign-spec">Transaction Signatures</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/weave-api-spec/weave-query-spec">Querying Weave</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/weave-api-spec/modules">Modules</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Tutorial</h4><ul><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/installation">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/domain">Domain</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/codec">Codec</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/weave/tutorial/models">Models</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/messages">Messages</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/buckets">Buckets</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/handlers">Handlers</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/app-level-codec">Application Level Codec</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/application">Application</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/batch-txs">Batch Transactions</a></li><li class="navListItem"><a class="navItem" href="/docs/weave/tutorial/cron-tasks">Scheduled Tasks</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">IOV Core<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/iov-core-tutorial/introduction">Introduction</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Models</h1></header><article><div><span><blockquote>
<p>code reference (model): <a href="https://github.com/iov-one/blog-tutorial/blob/master/x/blog/model.go">https://github.com/iov-one/blog-tutorial/blob/master/x/blog/model.go</a></p>
</blockquote>
<blockquote>
<p>code reference (test): <a href="https://github.com/iov-one/blog-tutorial/blob/master/x/blog/model_test.go">https://github.com/iov-one/blog-tutorial/blob/master/x/blog/model_test.go</a></p>
</blockquote>
<p>We defined our state in <a href="/docs/weave/tutorial/codec">codec section</a>. Models are wrapped codec with functionalities to integrate codec with Weave.
First ensure our <code>User</code> fulfills morm.Model:</p>
<pre><code class="hljs css language-go"><span class="hljs-keyword">var</span> _ morm.Model = (*User)(<span class="hljs-literal">nil</span>)
</code></pre>
<p>This is just a helper that enforces User model to fulfill morm.Model interface so that if you forget to implement a method, the compiler will complain. Guaranteeing it <em>I am trying to implement this interface</em>.</p>
<p>Now let's explain our model's identity:</p>
<h2><a class="anchor" aria-hidden="true" id="auto-incremented-identities"></a><a href="#auto-incremented-identities" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Auto incremented identities</h2>
<p><code>morm.Model</code> covers auto-incremented IDs for you. All you have to do is define <code>GetID</code> and <code>SetID</code> methods. If you defined <code>bytes id = 2 [(gogoproto.customname) = &quot;ID&quot;];</code> on <code>codec.proto</code> you do not even need to write <code>GetID</code> method by yourself. Thanks to prototool it will be generated automatically. You will only need to define <code>SetID</code> method.</p>
<h2><a class="anchor" aria-hidden="true" id="custom-identity"></a><a href="#custom-identity" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom identity</h2>
<p>To use your custom identity, do not define <code>bytes id = 2 [(gogoproto.customname) = &quot;ID&quot;];</code> on <code>codec.proto</code>. You can use any other field as an index with logic on top. Just write <code>SetID</code> and <code>GetID</code> logic that uses your index.</p>
<p>Now you see how indexing works in Weave. Let's see the other wonders of the framework.</p>
<h2><a class="anchor" aria-hidden="true" id="validation"></a><a href="#validation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Validation</h2>
<p>We will want to fill in these Validate methods to enforce any invariants we demand of the data to keep our database clean. Anyone who has spent much time dealing with production applications knows how “invalid data” can start creeping in without a strict database schema, this is what we do in code.</p>
<p>We can do some basic checks and return an error if any of them does not pass:</p>
<pre><code class="hljs css language-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *User)</span> <span class="hljs-title">Validate</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> {
    <span class="hljs-keyword">var</span> errs error

    errs = errors.AppendField(errs, <span class="hljs-string">"Metadata"</span>, m.Metadata.Validate())
    errs = errors.AppendField(errs, <span class="hljs-string">"ID"</span>, isGenID(m.ID, <span class="hljs-literal">false</span>))

    <span class="hljs-keyword">if</span> !validUsername(m.Username) {
        errs = errors.AppendField(errs, <span class="hljs-string">"Username"</span>, errors.ErrModel)
    }

    <span class="hljs-keyword">if</span> !validBio(m.Bio) {
        errs = errors.AppendField(errs, <span class="hljs-string">"Bio"</span>, errors.ErrModel)
    }

    <span class="hljs-keyword">if</span> err := m.RegisteredAt.Validate(); err != <span class="hljs-literal">nil</span> {
        errs = errors.AppendField(errs, <span class="hljs-string">"RegisteredAt"</span>, m.RegisteredAt.Validate())
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> m.RegisteredAt == <span class="hljs-number">0</span> {
        errs = errors.AppendField(errs, <span class="hljs-string">"RegisteredAt"</span>, errors.ErrEmpty)
    }

    <span class="hljs-keyword">return</span> errs
}
</code></pre>
<p>Here is a sample username validation function:</p>
<pre><code class="hljs css language-go"><span class="hljs-keyword">var</span> validUsername = regexp.MustCompile(<span class="hljs-string">`^[a-zA-Z0-9_.-]{4,16}$`</span>).MatchString
</code></pre>
<p>Note that model validation is run just before <a href="https://github.com/iov-one/weave/blob/v0.21.0/orm/model_bucket.go#L207-L209">saving</a> the model instance to data store.</p>
<p>If you need more complex validation rules for models you can implement custom validation function which uses <code>github.com/iov-one/weave/errors</code> as error handling.</p>
<p>We recommend using <code>errors.AppendField</code> as it enables multi-error validation so no information about the error's cause gets lost.</p>
<h2><a class="anchor" aria-hidden="true" id="errors"></a><a href="#errors" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Errors</h2>
<p>Here are some Weave errors taken from <a href="https://github.com/iov-one/weave/blob/master/errors/errors.go" title="Weave errors">weave/errors</a>:</p>
<pre><code class="hljs css language-go"><span class="hljs-comment">// ErrUnauthorized is used whenever a request without sufficient</span>
<span class="hljs-comment">// authorization is handled.</span>
ErrUnauthorized = Register(<span class="hljs-number">2</span>, <span class="hljs-string">"unauthorized"</span>)

<span class="hljs-comment">// ErrNotFound is used when a requested operation cannot be completed</span>
<span class="hljs-comment">// due to missing data.</span>
ErrNotFound = Register(<span class="hljs-number">3</span>, <span class="hljs-string">"not found"</span>)

<span class="hljs-comment">// ErrMsg is returned whenever an event is invalid and cannot be</span>
<span class="hljs-comment">// handled.</span>
ErrMsg = Register(<span class="hljs-number">4</span>, <span class="hljs-string">"invalid message"</span>)
</code></pre>
<p>What is with these <code>ErrXYZ()</code> calls, you may think? Well, we could return a “normal” error like <code>errors.New(&quot;fail&quot;)</code>, but we wanted two more features. First of all, it helps debugging enormously to have a stack trace of where the error occurred. For this, we use <a href="https://github.com/pkg/errors" title="go/pkg">pkg/errors</a> that attach a stack trace to the error that can optionally be printed later with a <code>Printf(&quot;%+v&quot;, err)</code>. We also want to return a unique abci error code, which may be interpreted by client applications, either programmatically or to provide translations of the error message client side.</p>
<p>For these reasons, Weave provides some utility methods and common error types in the errors <a href="https://godoc.org/github.com/iov-one/weave/errors">package</a>. The ABCI Code attached to the error is then returned in the <a href="https://github.com/iov-one/weave/blob/v0.20.0/abci.go#L114-L126">DeliverTx Result</a>.</p>
<p>Every package ideally can define its own custom error types and error codes, generally in a file called <a href="https://github.com/iov-one/weave/blob/master/x/sigs/errors.go">errors.go</a>. The key elements are:</p>
<pre><code class="hljs css language-go"><span class="hljs-comment">// ABCI Response Codes</span>
<span class="hljs-comment">// tutorial reserves 400 ~ 420.</span>
<span class="hljs-keyword">const</span> (
    CodeInvalidText    <span class="hljs-keyword">uint32</span> = <span class="hljs-number">400</span>
)

<span class="hljs-keyword">var</span> (
    errTitleTooLong       = fmt.Errorf(<span class="hljs-string">"Title is too long"</span>)
    errInvalidAuthorCount = fmt.Errorf(<span class="hljs-string">"Invalid number of blog authors"</span>)
)

<span class="hljs-comment">// Error code with no arguments, check on code not particular type</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ErrTitleTooLong</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> {
    <span class="hljs-keyword">return</span> errors.WithCode(errTitleTooLong, CodeInvalidText)
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">IsInvalidTextError</span><span class="hljs-params">(err error)</span> <span class="hljs-title">bool</span></span> {
    <span class="hljs-keyword">return</span> errors.HasErrorCode(err, CodeInvalidText)
}

<span class="hljs-comment">// You can also prepend a variable message using WithLog</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ErrInvalidAuthorCount</span><span class="hljs-params">(count <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">error</span></span> {
    msg := fmt.Sprintf(<span class="hljs-string">"authors=%d"</span>, count)
    <span class="hljs-keyword">return</span> errors.WithLog(msg, errInvalidAuthorCount, CodeInvalidAuthor)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="testing-model-validation"></a><a href="#testing-model-validation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing Model Validation</h2>
<p>Most of the testing logic in Weave is repetetive and similar. What you do is defining successful and failure cases for the validation with different field values. Here is a straight forward example that will make you understand quickly:</p>
<pre><code class="hljs css language-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestValidateUser</span><span class="hljs-params">(t *testing.T)</span></span> {
    now := weave.AsUnixTime(time.Now())

    cases := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">struct</span> {
        model    orm.Model
        wantErrs <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*errors.Error
    }{
        <span class="hljs-string">"success"</span>: {
            model: &amp;User{
                Metadata:     &amp;weave.Metadata{Schema: <span class="hljs-number">1</span>},
                ID:           weavetest.SequenceID(<span class="hljs-number">1</span>),
                Username:     <span class="hljs-string">"Crypt0xxx"</span>,
                Bio:          <span class="hljs-string">"Best hacker in the universe"</span>,
                RegisteredAt: now,
            },
            wantErrs: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*errors.Error{
                <span class="hljs-string">"Metadata"</span>:     <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"ID"</span>:           <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"Username"</span>:     <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"Bio"</span>:          <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"RegisteredAt"</span>: <span class="hljs-literal">nil</span>,
            },
        },
        <span class="hljs-comment">// TODO add missing metadata test</span>
        <span class="hljs-string">"success no bio"</span>: {
            model: &amp;User{
                Metadata:     &amp;weave.Metadata{Schema: <span class="hljs-number">1</span>},
                ID:           weavetest.SequenceID(<span class="hljs-number">1</span>),
                Username:     <span class="hljs-string">"Crypt0xxx"</span>,
                RegisteredAt: now,
            },
            wantErrs: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*errors.Error{
                <span class="hljs-string">"Metadata"</span>:     <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"ID"</span>:           <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"Username"</span>:     <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"Bio"</span>:          <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"RegisteredAt"</span>: <span class="hljs-literal">nil</span>,
            },
        },
        <span class="hljs-string">"failure missing ID"</span>: {
            model: &amp;User{
                Metadata:     &amp;weave.Metadata{Schema: <span class="hljs-number">1</span>},
                Username:     <span class="hljs-string">"Crypt0xxx"</span>,
                Bio:          <span class="hljs-string">"Best hacker in the universe"</span>,
                RegisteredAt: now,
            },
            wantErrs: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*errors.Error{
                <span class="hljs-string">"Metadata"</span>:     <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"ID"</span>:           errors.ErrEmpty,
                <span class="hljs-string">"Username"</span>:     <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"Bio"</span>:          <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"RegisteredAt"</span>: <span class="hljs-literal">nil</span>,
            },
        },
        <span class="hljs-string">"failure missing username"</span>: {
            model: &amp;User{
                Metadata:     &amp;weave.Metadata{Schema: <span class="hljs-number">1</span>},
                ID:           weavetest.SequenceID(<span class="hljs-number">1</span>),
                Bio:          <span class="hljs-string">"Best hacker in the universe"</span>,
                RegisteredAt: now,
            },
            wantErrs: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*errors.Error{
                <span class="hljs-string">"Metadata"</span>:     <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"ID"</span>:           <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"Username"</span>:     errors.ErrModel,
                <span class="hljs-string">"Bio"</span>:          <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"RegisteredAt"</span>: <span class="hljs-literal">nil</span>,
            },
        },
        <span class="hljs-string">"failure missing registered at"</span>: {
            model: &amp;User{
                Metadata: &amp;weave.Metadata{Schema: <span class="hljs-number">1</span>},
                ID:       weavetest.SequenceID(<span class="hljs-number">1</span>),
                Username: <span class="hljs-string">"Crypt0xxx"</span>,
                Bio:      <span class="hljs-string">"Best hacker in the universe"</span>,
            },
            wantErrs: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*errors.Error{
                <span class="hljs-string">"Metadata"</span>:     <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"ID"</span>:           <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"Username"</span>:     <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"Bio"</span>:          <span class="hljs-literal">nil</span>,
                <span class="hljs-string">"RegisteredAt"</span>: errors.ErrEmpty,
            },
        },
    }
    <span class="hljs-keyword">for</span> testName, tc := <span class="hljs-keyword">range</span> cases {
        t.Run(testName, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> {
            err := tc.model.Validate()
            <span class="hljs-keyword">for</span> field, wantErr := <span class="hljs-keyword">range</span> tc.wantErrs {
                assert.FieldError(t, err, field, wantErr)
            }
        })
    }
}
</code></pre>
<p><em>&quot;I want to point out again and make it persistent in your mind: Extensive Validation is crucial.&quot;</em></p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated by Orkun Külçe</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/weave/tutorial/codec"><span class="arrow-prev">← </span><span>Codec</span></a><a class="docs-next button" href="/docs/weave/tutorial/messages"><span>Messages</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#auto-incremented-identities">Auto incremented identities</a></li><li><a href="#custom-identity">Custom identity</a></li><li><a href="#validation">Validation</a></li><li><a href="#errors">Errors</a></li><li><a href="#testing-model-validation">Testing Model Validation</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"></a><div><h5>Docs</h5><a href="/docs/iov-name-service/validator/rewards">IOV Name Service</a><a href="/docs/weave/welcome">Weave</a></div><div><h5>Community</h5><a href="https://riot.im/app/#/room/#weave:matrix.org" target="_blank">Riot Chat</a><a href="https://t.me/internetofvalues" target="_blank">Telegram</a><a href="https://twitter.com/iov_official" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="https://github.com/iov-one" target="_blank">GitHub</a><a href="https://www.iov.one" target="_blank">Website</a></div></section><section class="copyright">Copyright © 2020 IOV</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '8dc8128a9091306e7bbd0effdaa5241a',
                indexName: 'iov',
                inputSelector: '#search_input_react'
              });
            </script></body></html>